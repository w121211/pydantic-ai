# Planner Agent

- 要幫助用戶的 task 規劃 plan，plan 包含一系列的 steps
- 這些 steps 將會透過被 agent 依序執行，每個 step 會由一個 agent 協助完成（其中可能會有用戶參與）
- 若用戶提出來的 task 過於龐大，planner 會與用戶透過對話方式，釐清用戶的需求，調整成適合的 task
- Planner 提出 plan 後用戶會檢視並給予意見，只有當用戶 APPROVE 時才結束，並輸出 plan

例如（這裡只是用來展示，實際要更為複雜）：
- 初始 task：宣傳我的開源專案
- 經過討論調整後的 task：每天瀏覽網上技術論壇，搜尋與我的開源專案相關的討論串，參與討論
- Steps:
  - 在技術論壇 A、B、C 搜尋某技術的相關討論串
  - Agent 選擇適合的討論串
  - Agent 編寫回復文，用戶檢視並給予建議，直到檢視通過
  - 送出回復文

### 作法

Approach 1: 直接用 pydantic-ai 的 `return_type` 來讓 agent 直接輸出 task strctured data
- 我覺得這等於叫 planner 做兩件事，1. 和 user 討論 2. 輸出結構資料，較為複雜
- LLM 似乎在指定輸出格式下的表現沒有自由輸出（text output）來得好
- => 決定採 Approach 2

Approach 2: 分兩步驟 1. 先用 planner agent 純文字輸出 plan（在 prompt 裡給予 plan 的範例）， 2. 再用一個 parser agent 將 text plan 轉換成 structured data

### 轉換成結構化資訊（討論）

Task Plan 需要的資訊：
- project: 這個 task 所屬的 project
  - 是用 id，還是用 name？若還沒有創建這個 prooject 怎麼辦？
- task:
  - 一行就好，短、精簡、好懂
  - 如果實在沒法塞在這麼短的裡面，那可能是因為這個 task 要做的事情實在太多了，應該分成多個 tasks
- steps

Step 需要的資訊：
- step order: 1, 2, 3, ...
- step name: 一行就好，短、精簡、好懂，這是給人讀的
- team: 這個 step 需要的成員，包含 assistants（@assistant, @function_executor, ...）及 human members（only @user for MVP）
- 假設這個 step 是純 function，要怎樣指示？（要考慮到這個 function 需不需要 agent 協助執行）
- 成果（work）需要用戶檢視後才能輸出嗎？
  - 如果不用的話成果就直接輸出
- input data type
- output data type
  - 例如： string, data type (用 typescript 或是 json schema之類的定義？), ...





**範例 1: 宣傳我的開源專案**

初始 Task:宣傳我的開源專案
討論後調整的 Task:每天瀏覽網上技術論壇，搜尋與我的開源專案相關的討論串，參與討論
Steps:
1. 搜尋相關討論串
  - 在技術論壇 A、B、C 搜尋與我的專案技術領域相關的討論串。
  - 關鍵字：開源、專案技術名稱、相關問題。
2.	篩選適合的討論串
	- Agent 根據討論熱度和專案相關性，選擇 3-5 個討論串。
3.	撰寫回復文
	- Agent 根據討論內容草擬回復文，包含專案的價值與技術解決方案。
	- 用戶檢視回復文並提供建議，直到通過審核。
4.	送出回復文
	- 在選定的討論串中發表已審核的回復。
5.	記錄與後續跟進
	- 記錄參與的討論串及發表的回復。
	- 每日檢查回復是否有後續問題，並決定是否跟進。


**範例 2: 設計並發布促銷活動**

初始 Task:設計並發布促銷活動

討論後調整的 Task:設計一個週年慶折扣促銷活動，並在社交媒體上發布

Steps:
	1.	確定促銷內容
	•	與用戶確認促銷細節，例如折扣比例、期限、參與條件。
	2.	設計活動海報與文案
	•	Agent 根據用戶的需求設計一張視覺吸引力高的促銷海報。
	•	編寫簡潔的促銷文案，並讓用戶審核。
	3.	選擇發布平台
	•	確定發布的社交媒體平台（如 Twitter、Facebook、Instagram）。
	4.	發布活動
	•	Agent 協助發布促銷內容至各社交媒體平台。
	5.	追蹤效果與優化
	•	分析活動成效（如按讚、分享、點擊率）。
	•	提出後續優化建議。

**範例 3: 優化我的個人品牌形象**

初始 Task:提升我的個人品牌形象

討論後調整的 Task:每週撰寫並發布一篇專業技術文章，吸引更多的關注者

Steps:
	1.	確定主題
	•	與用戶討論，確定下週文章的技術主題。
	•	目標：分享專業知識或解決特定問題。
	2.	資料蒐集與整理
	•	Agent 協助蒐集相關資料，包括最佳實踐與實例。
	3.	撰寫文章初稿
	•	Agent 根據資料撰寫技術文章初稿，用戶審閱後提出修改建議。
	4.	優化與排版
	•	根據用戶意見，完善文章內容與排版。
	5.	發布文章
	•	Agent 協助將文章發布至用戶的個人網站、技術部落格或社交媒體。
	6.	互動與回覆
	•	每日查看文章留言，並與讀者互動，提升參與度。

**範例 4: 開發一個簡單的手機應用程式**

初始 Task:開發一個簡單的手機應用程式

討論後調整的 Task:開發一個任務追蹤應用程式，支援新增、編輯、刪除與提醒功能

Steps:
	1.	需求分析
	•	與用戶確認應用程式的功能需求與使用情境。
	2.	設計應用程式架構
	•	Agent 協助設計應用程式的功能架構與頁面佈局。
	3.	開發基本功能
	•	實作新增、編輯、刪除與提醒的基本功能模組。
	4.	測試與調整
	•	測試應用程式的功能與界面，記錄並修正問題。
	5.	發布 MVP 版本
	•	將應用程式上架到測試平台，收集用戶反饋。
	6.	計劃下一步優化
	•	根據用戶反饋，規劃後續版本的功能改進。



---

```jsonc
// 範例 1 轉換成 Structured Data**
{
  "project": "宣傳我的開源專案",
  "task": "每天瀏覽網上技術論壇，搜尋與我的開源專案相關的討論串，參與討論",
  "steps": [
    {
      "step_number": 1,
      "step_description": "搜尋相關討論串",
      "details": [
        "在技術論壇 A、B、C 搜尋與我的專案技術領域相關的討論串",
        "關鍵字：開源、專案技術名稱、相關問題"
      ]
    },
    {
      "step_number": 2,
      "step_description": "篩選適合的討論串",
      "details": [
        "Agent 根據討論熱度和專案相關性，選擇 3-5 個討論串"
      ]
    },
    {
      "step_number": 3,
      "step_description": "撰寫回復文",
      "details": [
        "Agent 根據討論內容草擬回復文，包含專案的價值與技術解決方案",
        "用戶檢視回復文並提供建議，直到通過審核"
      ]
    },
    {
      "step_number": 4,
      "step_description": "送出回復文",
      "details": [
        "在選定的討論串中發表已審核的回復"
      ]
    },
    {
      "step_number": 5,
      "step_description": "記錄與後續跟進",
      "details": [
        "記錄參與的討論串及發表的回復",
        "每日檢查回復是否有後續問題，並決定是否跟進"
      ]
    }
  ]
}
```

